function ua(a){var c=new Array;var b="";if(c=a.match(/MSIE\s([^\s|;]+)/gi)){b='<span class="ua_ie"><i class="fa fa-globe"></i> Internet Explorer|'+c[0]}else{if(c=a.match(/FireFox\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_firefox"><i class="fa fa-globe"></i> Mozilla FireFox|'+d[1]}else{if(c=a.match(/Maxthon([\d]*)\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_maxthon"><i class="fa fa-globe"></i> Maxthon'}else{if(c=a.match(/UBrowser([\d]*)\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_ucweb"> <i class="fa fa-globe"></i>UCBrowser|'+d[1]}else{if(c=a.match(/MetaSr/ig)){b='<span class="ua_sogou"> <i class="fa fa-globe"></i>搜狗浏览器'}else{if(c=a.match(/2345Explorer/ig)){b='<span class="ua_2345explorer"><a href="http://www.91txh.com/2345download.php?id=2" target="_blank" style="color:#FFFFFF!important;"> 2345王牌浏览器</a>'}else{if(c=a.match(/2345chrome/ig)){b='<span class="ua_2345chrome"><a href="http://www.91txh.com/2345download.php?id=3" target="_blank" style="color:#FFFFFF!important;"> 2345加速浏览器</a>'}else{if(c=a.match(/LBBROWSER/ig)){b='<span class="ua_lbbrowser"> <i class="fa fa-globe"></i>猎豹安全浏览器'}else{if(c=a.match(/MicroMessenger\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_qq"> 微信|'+d[1]}else{if(c=a.match(/QQBrowser\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_qq"> <i class="fa fa-globe"></i>QQ浏览器|'+d[1]}else{if(c=a.match(/QQ\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_qq"> <i class="fa fa-globe"></i>QQ浏览器|'+d[1]}else{if(c=a.match(/MiuiBrowser\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_mi"> <i class="fa fa-globe"></i>Miui浏览器|'+d[1]}else{if(c=a.match(/Chrome([\d]*)\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_chrome"> <i class="fa fa-globe"></i>Chrome|'+d[1]}else{if(c=a.match(/safari\/([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_apple"> <i class="fa fa-globe"></i>Apple Safari|'+d[1]}else{if(c=a.match(/Opera[\s|\/]([^\s]+)/ig)){var d=c[0].split("/");b='<span class="ua_opera"> <i class="fa fa-globe"></i>Opera|'+c[1]}else{if(c=a.match(/Trident\/7.0/gi)){b='<span class="ua_ie"> <i class="fa fa-globe"></i>Internet Explorer 11'}else{b='<span class="ua_other"> <i class="fa fa-globe"></i>其它浏览器'}}}}}}}}}}}}}}}}return b+"</span> "}function os(a){var b="";if(a.match(/win/ig)){if(a.match(/nt 5.1/ig)){b='<span class="os_xp"> <i class="fa fa-desktop"></i>Windows XP'}else{if(a.match(/nt 6.1/ig)){b='<span class="os_7"> <i class="fa fa-desktop"></i>Windows 7'}else{if(a.match(/nt 6.2/ig)){b='<span class="os_8"> <i class="fa fa-desktop"></i>Windows 8'}else{if(a.match(/nt 6.3/ig)){b='<span class="os_8_1"> <i class="fa fa-desktop"></i>Windows 8.1'}else{if(a.match(/nt 6.0/ig)){b='<span class="os_vista"> <i class="fa fa-desktop"></i>Windows Vista'}else{if(a.match(/nt 5/ig)){b='<span class="os_2000"> <i class="fa fa-desktop"></i>Windows 2000'}else{b='<span class="os_windows"><i class="fa fa-desktop"></i> Windows'}}}}}}}else{if(a.match(/android/ig)){b='<span class="os_android"><i class="fa fa-android"></i> Android'}else{if(a.match(/ubuntu/ig)){b='<span class="os_ubuntu"><i class="fa fa-linux"></i> Ubuntu'}else{if(a.match(/linux/ig)){b='<span class="os_linux"> <i class="fa fa-linux"></i>Linux'}else{if(a.match(/mac/ig)){b='<span class="os_mac"> Mac OS X'}else{if(a.match(/unix/ig)){b='<span class="os_unix"> <i class="fa fa-linux"></i>Unix'}else{if(a.match(/symbian/ig)){b='<span class="os_nokia"> Nokia SymbianOS'}else{b='<span class="os_other"> 其它操作系统'}}}}}}}return b+"</span>"}(function(am,a2,aL){function ae(a,c){for(var b in c){c[b]&&(a[b]?a[b].set(c[b]):a[b]=new ao(c[b]))}}function ar(a,c){for(var b in c){a[b]=c[b]}}function aI(){if(a5.checkPermission()){return}var d;while(d=aP.shift()){var b=a5.createNotification(d.iconUrl,d.title,d.body),a=d.url;try{b.onclick=function(){am.focus(),aW.href=a,b.cancel()}}catch(c){}b.show(),setTimeout(function(){b.cancel&&b.cancel()},8000)}}function aj(){return aY.data.user_id==0}function ay(a,d,b){if(aO){try{aO.removeItem(a),aO.removeItem(a+":timestamp"),aO[a]=az.stringify(d),aO[a+":timestamp"]=Math.floor(b)}catch(c){}}}function aT(a){ba.theme=a,a!="none"&&ba.injectStylesheet(af+"/styles/embed"+(a?"."+a+".css?"+be[a]:"."+short_name)+".css")}if(am.DUOSHUO){return}var aW=am.location,az=am.JSON,aZ=am.XMLHttpRequest,aO=az&&az.stringify&&am.localStorage,a5=am.webkitNotifications,ac=a2.getElementsByTagName("head")[0]||a2.getElementsByTagName("body")[0],ap=am.navigator.userAgent,aG=a2.location.protocol=="https:"?"https:":"http:",ah=0,aw,aR=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=/&(?!\w+;)|[<>"'`]/g,b=/[&<>"'`]/,c=function(e){return a[e]||"&amp;"};return function(f){return f==null||f===!1?"":b.test(f)?f.replace(d,c):f}}(),ak=function(a){if(a.match(/^(http|https):/)){return a}var b=a2.createElement("a");return b.href=a,bc.hrefNormalized?b.href:b.getAttribute("href",4)},a8={start:0,end:0},aJ=function(c){var h=this,k=0,g=0,l,j,m,b,d;a2.selection&&(j=a2.selection.createRange(),j&&j.parentElement()==h&&(b=h.value.length,l=h.value.replace(/\r\n/g,"\n"),m=h.createTextRange(),m.moveToBookmark(j.getBookmark()),d=h.createTextRange(),d.collapse(!1),m.compareEndPoints("StartToEnd",d)>-1?k=g=b:(k=-m.moveStart("character",-b),k+=l.slice(0,k).split("\n").length-1,m.compareEndPoints("EndToEnd",d)>-1?g=b:(g=-m.moveEnd("character",-b),g+=l.slice(0,g).split("\n").length-1)))),a8.start=k,a8.end=g},au=function(a){return function(){return a}},be={"default":"d6149e1c",dark:"c11b5925",bluebox:"dbc0a9af"},af=aG+"//static.duoshuo.com",ba=am.DUOSHUO={DOMAIN:"duoshuo.com",REMOTE:"http://duoshuo.com",version:140327,loaded:{jQuery:typeof jQuery!="undefined"&&jQuery.fn.jquery>="1.5",smilies:!1,mzadxN:typeof mzadxN!="undefined"},libs:{jQuery:af+"/libs/embed.compat.js?24f8ca3f.js",smilies:af+"/libs/smilies.js?921e8eda.js",mzadxN:"http://js.miaozhen.com/mz_ad_serving.js"},sourceName:{weibo:"\u65b0\u6d6a\u5fae\u535a",qq:"QQ",qzone:"QQ\u7a7a\u95f4",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",douban:"\u8c46\u74e3\u7f51",netease:"\u7f51\u6613\u5fae\u535a",kaixin:"\u5f00\u5fc3\u7f51",sohu:"\u641c\u72d0\u5fae\u535a",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",msn:"MSN",google:"\u8c37\u6b4c"},serviceNames:{weibo:"\u5fae\u535a",qq:"QQ",douban:"\u8c46\u74e3",renren:"\u4eba\u4eba",netease:"\u7f51\u6613",kaixin:"\u5f00\u5fc3",sohu:"\u641c\u72d0",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",msn:"MSN",google:"\u8c37\u6b4c"},parseDate:function(a){return a.parse("2011-10-28T00:00:00+08:00")&&function(b){return new a(b)}||a.parse("2011/10/28T00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||a.parse("2011/10/28 00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(b){return new a(b)}}(Date),fullTime:function(a){var b=ba.parseDate(a);return b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5 "+b.toLocaleTimeString()},elapsedTime:function(a){var d=ba.parseDate(a),b=new Date,c=(b-ah-d)/1000;return c<10?"\u521a\u521a":c<60?Math.round(c)+"\u79d2\u524d":c<3600?Math.round(c/60)+"\u5206\u949f\u524d":c<86400?Math.round(c/3600)+"\u5c0f\u65f6\u524d":(b.getFullYear()==d.getFullYear()?"":d.getFullYear()+"\u5e74")+(d.getMonth()+1)+"\u6708"+d.getDate()+"\u65e5"},require:function(a,d){if(typeof a=="string"){ba.loaded[a]?d():aq(ba.libs[a],function(){ba.loaded[a]=!0,d()})}else{if(typeof a=="object"){var b,c=!0;for(b=0;b<a.length;b++){(function(e){if(ba.loaded[a[b]]){return}c=!1,aq(ba.libs[e],function(){ba.loaded[e]=!0;for(var f=0;f<a.length;f++){if(!ba.loaded[a[f]]){return}}d()})})(a[b])}c&&d()}}},getCookie:function(c){var g=" "+c+"=",d=a2.cookie.split(";"),h=0,f,j,b;for(;h<d.length;h++){f=" "+d[h],j=f.indexOf(g);if(j>=0&&j+g.length==(b=f.indexOf("=")+1)){return decodeURIComponent(f.substring(b,f.length).replace(/\+/g,""))}}return aL},param:function(a){var c=[];for(var b in a){a[b]!=aL&&c.push(b+"="+encodeURIComponent(a[b]))}return c.join("&")},ajax:function(g,p,n,m,q){var b=ba.getCookie("duoshuo_token");n.v=ba.version,b?n.jwt=b:bg.remote_auth&&(n.remote_auth=bg.remote_auth);if(aZ&&az&&az.parse){var i=new aZ;if(!!i&&"withCredentials" in i){var k;function d(u,A,x,y){var z,h,v,w=A;if(u>=200&&u<300||u===304){if(u===304){w="notmodified",z=!0}else{try{h=az.parse(x),w="success",z=!0}catch(o){w="parsererror",v=o}}}else{v=w;if(!w||u){w="error",u<0&&(u=0)}try{h=az.parse(x)}catch(o){w="parsererror",v=o}}z?m(h):w==="parseerror"?aA("\u89e3\u6790\u9519\u8bef: "+x):(q&&q(h),aA("\u51fa\u9519\u5566("+h.code+"): "+h.errorMessage),h.errorTrace&&aA(h.errorTrace))}i.open(g,ba.hostUrl+p+".json"+(g=="GET"?"?"+ba.param(n):""),!0),i.withCredentials=!0,i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(g=="GET"?null:ba.param(n)),k=function(f,x){var v,h,w,l;try{if(k&&(x||i.readyState===4)){k=aL;if(x){i.readyState!==4&&i.abort()}else{v=i.status,w=i.getAllResponseHeaders();try{l=i.responseText}catch(f){}try{h=i.statusText}catch(y){h=""}}}}catch(c){x||d(-1,c)}l&&d(v,h,l,w)},i.readyState===4?k():i.onreadystatechange=k;return}}g!="GET"&&(n._method="POST");var j="cb_"+Math.round(Math.random()*1000000);ba[j]=function(a){switch(a.code){case 0:m(a);break;default:q&&q(a),aA("\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage),a.errorTrace&&aA(a.errorTrace)}},n.callback="DUOSHUO['"+j+"']",aq(ba.hostUrl+p+".jsonp?"+ba.param(n))},injectStylesheet:function(a){var b=a2.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a,ac.appendChild(b)},setCustomStyle:function(a){aw||(aw=a2.createElement("style"),aw.type="text/css",ac.appendChild(aw)),a=a.replace(/\}/g,"}\n");if(aw.styleSheet){aw.styleSheet.cssText=a}else{while(aw.firstChild){aw.removeChild(aw.firstChild)}aw.appendChild(a2.createTextNode(a))}},compileStyle:function(a){var d="",b={textbox:"#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper"};if(a){for(var c in a){d+=b[c]+"{"+a[c]+"}\n"}}return d},init:function(a,b){a&&!aM[a]&&(aM[a]=b||{type:"EmbedThread"}),ba.initView&&ba.initView()}},an=a2.all,a0,bc=ba.support=function(){var b=a2.createElement("div");b.innerHTML='<a href="/a">a</a><input type="checkbox"/>';var a=b.getElementsByTagName("a")[0],c=b.getElementsByTagName("input")[0],d={placeholder:"placeholder" in c,touch:"ontouchstart" in am||"onmsgesturechange" in am,hrefNormalized:a.getAttribute("href")==="/a",iOS:ap.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:ap.match(/ \(Linux; U; Android /)};return a0=!aZ&&typeof b.style.maxHeight=="undefined",d.authInWin=am.postMessage&&am.screen.width>800&&!d.iOS&&!d.android&&aW.origin,d}(),a3=function(a,c){var d=(a2.body||a2.documentElement).style;if(typeof d=="undefined"){return !1}if(typeof d[a]=="string"){return c?a:!0}var b=["Moz","Webkit","ms"],a=a.charAt(0).toUpperCase()+a.substr(1),f=0;for(;f<b.length;f++){if(typeof d[b[f]+a]=="string"){return c?b[f]+a:!0}}},aM=ba.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"}},ai=ba.pagelets=[],aE={post:"\u53d1\u5e03",posting:"\u6b63\u5728\u53d1\u5e03",settings:"\u8bbe\u7f6e",reply:"\u56de\u590d",like:"\u9876",repost:"\u8f6c\u53d1",report:"\u4e3e\u62a5","delete":"\u5220\u9664",reply_to:"\u56de\u590d ",reposts:"\u8f6c\u53d1",comments:"\u8bc4\u8bba",floor:"\u697c",latest:"\u6700\u65b0",earliest:"\u6700\u65e9",hottest:"\u6700\u70ed",share_to:"\u5206\u4eab\u5230:",leave_a_message:"\u8bf4\u70b9\u4ec0\u4e48\u5427\u2026",no_comments_yet:"\u8fd8\u6ca1\u6709\u8bc4\u8bba\uff0c\u6c99\u53d1\u7b49\u4f60\u6765\u62a2",repost_reason:"\u8bf7\u8f93\u5165\u8f6c\u53d1\u7406\u7531",hot_posts_title:"\u88ab\u9876\u8d77\u6765\u7684\u8bc4\u8bba",comments_zero:"\u6682\u65e0\u8bc4\u8bba",comments_one:"1\u6761\u8bc4\u8bba",comments_multiple:"{num}\u6761\u8bc4\u8bba",reposts_zero:"\u6682\u65e0\u8f6c\u53d1",reposts_one:"1\u6761\u8f6c\u53d1",reposts_multiple:"{num}\u6761\u8f6c\u53d1",weibo_reposts_zero:"\u6682\u65e0\u65b0\u6d6a\u5fae\u535a",weibo_reposts_one:"1\u6761\u65b0\u6d6a\u5fae\u535a",weibo_reposts_multiple:"{num}\u6761\u65b0\u6d6a\u5fae\u535a",qqt_reposts_zero:"\u6682\u65e0\u817e\u8baf\u5fae\u535a",qqt_reposts_one:"1\u6761\u817e\u8baf\u5fae\u535a",qqt_reposts_multiple:"{num}\u6761\u817e\u8baf\u5fae\u535a"},aH=function(a,d,b,c){ba.ajax("GET",a,d,b||function(){},c)},ad=function(a,d,b,c){ba.ajax("POST",a,d,b||function(){},c)},aP=[],aK,ab=[],al=function(a){if(!("WebSocket" in am&&az)){return !1}ab.push(az.stringify(a)),aK||(aK=ba.webSocket=new WebSocket("ws://ws.duoshuo.com:8201/"),aK.onopen=function(){var b;if(aK.readyState===1){while(b=ab.shift()){aK.send(b)}}},aK.onmessage=function(b){try{var g=0,c,d=az.parse(b.data)}catch(f){return}switch(d.type){case"post":for(;g<ba.pagelets.length;g++){c=ba.pagelets[g],c.threadId==d.thread_id&&c.onMessage(d)}break;case"notification":aP.push(d),aI();break;default:}},am.addEventListener("beforeunload",function(){aK.close()})),aK.onopen()},aS=ba.Collections={},ax=ba.Views={},ag=ba.Callbacks={},aC=ba.openDialog=function(a){return ba.dialog!==aL&&ba.dialog.el.remove(),ba.dialog=(new ax.Dialog('<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+a+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a></div></div>')).open()},aq=ba.injectScript=function(c,a){var d=a2.createElement("script"),b=a2.head||a2.getElementsByTagName("head")[0]||a2.documentElement;d.type="text/javascript",d.src=c,d.async="async",d.charset="utf-8",a&&(d.onload=d.onreadystatechange=function(f,e){if(e||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,b&&d.parentNode&&b.removeChild(d),d=aL,e||a.call(am)}}),b.insertBefore(d,b.firstChild)},aA=ba.log=function(a){typeof console=="object"&&console.log(a)},aU=ba.smilies={},aX=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"],a6=0,bg,bb=function(){var a={},c=0;for(;c<arguments.length;c++){arguments[c]&&ar(a,arguments[c])}var b=ba.param(a);return b?"?"+b:""},bd=function(){var a=ba.getCookie("duoshuo_token");return a?{jwt:a}:bg.remote_auth?{short_name:bg.short_name,remote_auth:bg.remote_auth}:aL},a9=function(){return !bg&&(bg=am.duoshuoQuery)&&a4.trigger("queryDefined"),bg};for(var aa in Object.prototype){return alert("Object.prototype\u4e0d\u4e3a\u7a7a\uff0c\u8bf7\u4e0d\u8981\u7ed9Object.prototype\u8bbe\u7f6e\u65b9\u6cd5")}var aD=ba.templates={userUrl:function(a){return a.url},avatarUrl:function(a,b){return a.avatar_url||aN.data.default_avatar_url},userAnchor:function(a){var b=aD.userUrl(a);return b?'<a rel="nofollow author" target="_blank" href="'+aR(b)+'">'+aR(a.name)+"</a>":aR(a.name)},avatarImg:function(a,b){return'<img src="'+aR(aD.avatarUrl(a,b))+'" alt="'+aR(a.name)+'"'+(b?' style="width:'+b+"px;height:"+b+'px"':"")+"/>"},avatar:function(a,d){var b=aD.avatarImg(a,d),c=aD.userUrl(a);return c?'<a rel="nofollow author" target="_blank" href="'+aR(c)+'" '+(a.user_id?" onclick=\"this.href='"+ba.hostUrl+"/user-url/?user_id="+a.user_id+"';\"":"")+' title="'+aR(a.name)+'">'+b+"</a>":b},timeHtml:function(a,b){return a?b?'<a href="'+b+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+a+'" title="'+ba.fullTime(a)+'">'+ba.elapsedTime(a)+"</a>":'<span class="ds-time" datetime="'+a+'" title="'+ba.fullTime(a)+'">'+ba.elapsedTime(a)+"</span>":""},serviceIcon:function(a,b){return'<a href="javascript:void(0)" class="ds-service-icon'+(b?"-grey":"")+" ds-"+a+'" data-service="'+a+'" title="'+ba.sourceName[a]+'"></a>'},loginButtons:function(a){return'<div class="ds-login-buttons"><p>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55:</p><div class="ds-social-links">'+aD.serviceList()+aD.additionalServices()+"</div></div>"},poweredBy:function(a){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+aR(a)+"</a></p>"},indicator:au('<div id="ds-indicator"></div>'),waitingImg:au('<div id="ds-waiting"></div>'),serviceList:function(a){var d='<ul class="ds-service-list">',b=["weibo","qq","renren","douban"],c=0;for(;c<b.length;c++){d+=aD.loginItem(b[c],a)}return d+'<li><a class="ds-more-services" href="javascript:void(0)">\u66f4\u591a\u00bb</a></li></ul>'},additionalServices:function(a){var d='<ul class="ds-service-list ds-additional-services">',b=["kaixin","netease","sohu","baidu","google"],c=0;for(;c<b.length;c++){d+=aD.loginItem(b[c],a)}return d+"</ul>"},loginItem:function(a,c){var b=aD[c?"bindUrl":"loginUrl"](a);return'<li><a href="'+b+'" rel="nofollow" class="ds-service-link ds-'+a+'">'+ba.serviceNames[a]+(aY.data.social_uid[a]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"},loginUrl:function(a,b){return b||(b={}),bg.sso&&bg.sso.login&&(b.sso=1,b.redirect_uri=bg.sso.login),ba.hostUrl+"/login/"+a+"/"+bb(b)},bindUrl:function(a){return ba.hostUrl+"/bind/"+a+"/"+bb(bg.sso&&bg.sso.login?{sso:1,redirect_uri:bg.sso.login}:null,bd())},logoutUrl:function(){return ba.hostUrl+"/logout/"+bb(bg.sso&&bg.sso.logout?{sso:1,redirect_uri:bg.sso.logout}:null)},likePost:function(a){return'<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+aE.like+(a.likes>0?"("+a.likes+")":"")+"</a>"},ctxPost:function(a,d,b){var c=aF(a);return'<li class="ds-ctx-entry"'+(b?' style="display:none"':"")+' data-post-id="'+a.post_id+'"><div class="ds-avatar">'+aD.avatar(c)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+aD.userAnchor(c)+aD.timeHtml(a.created_at,a.url)+(d>=0?'<div class="ds-ctx-nth" title="'+ba.fullTime(a.created_at)+'">'+(d+1)+aE.floor+"</div>":"")+'</div><div class="ds-ctx-content">'+a.message+(d>=0?'\u3000\u3000\u3000\u3000\u3000\u3000\u3000<div class="ds-comment-actions'+(a.vote>0?" ds-post-liked":"")+'">'+aD.likePost(a)+' <a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aE.repost+'</a> <a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aE.reply+"</a></div>":"")+"</div></div></li>"}},aF=function(a){return a7[a.author_id]&&a7[a.author_id].data||a.author},aV=function(a){var c=[];for(var b in a){c.push('<input type="hidden" name="'+b+'" value="'+aR(a[b])+'" />')}return c.join("\n")};for(;a6<aX.length;a6++){ba[aX[a6]]=function(a){return function(c,b){b=b||{},b.type=a,c&&!aM[c]&&(aM[c]=b),ba.initSelector&&ba.initSelector(c,b)}}(aX[a6]),ba["create"+aX[a6]]=function(a){return function(c,d){var b=a2.createElement(c);for(var e in d){b.setAttribute("data-"+e,d[e])}return ba[a](b),b}}(aX[a6])}ba.RecentCommentsWidget=ba.RecentComments;var av=0,bf=ba.Class=function(){};bf.extend=function(a){function c(){!av&&this.init&&this.init.apply(this,arguments)}av=1;var d=new this;av=0;for(var b in a){d[b]=a[b]}return c.prototype=d,c.prototype.constructor=c,c.extend=arguments.callee,c};var bh=ba.Event=bf.extend({on:function(a,c){var b=this.handlers||(this.handlers={});return b[a]===aL&&(b[a]=[]),b[a].push(c),this},trigger:function(a,d){var b=(this.handlers||(this.handlers={}))[a];if(b){for(var c=0;c<b.length;c++){if(b[c].call(this,d)===!1){break}}}return this}}),ao=ba.Model=bh.extend({init:function(a){this.data=a},reset:function(a){this.data=a,this.trigger("reset")},remove:function(a){this.data.splice(a,1),this.trigger("reset")},set:function(a,c){if(c===aL){for(var b in a){this.data[b]=a[b]}}else{this.data[a]=c}this.trigger("reset")}}),a4=ba.events=new bh,aN=ba.site=new ao,aY=ba.visitor=new ao,aB=ba.unread=new ao,a1=ba.threads={},aQ=ba.postPool={},a7=ba.users={};a4.on("queryDefined",function(){var a=bg.short_name;ba.hostUrl=a?aG+"//"+a+"."+ba.DOMAIN:ba.REMOTE,bg.theme&&aT(bg.theme);if(aO){var c=aO["ds_site_"+a],b=aO["ds_lang_"+a];c&&aN.reset(az.parse(c)),b&&ar(aE,az.parse(b))}}),a9(),ba.loaded.jQuery&&(ba.jQuery=am.jQuery),ba.require("jQuery",function(){function j(a,h,g){if(a.find(".ds-post[data-post-id="+h.post_id+"]")[0]){return}return a.find(".ds-post-placeholder").remove(),q(aD.post(h,g)).hide()[g.order=="asc"?"appendTo":"prependTo"](a).slideDown(function(){})}function C(a,h){var g;this.delegate("a.ds-post-likes","click",function(i){if(aj()){return o(),!1}var l=q(this).parent();return liked=l.hasClass("ds-post-liked"),matches=q(this).html().match(/\((\d+)\)/),likes=(matches?parseInt(matches[1]):0)+(liked?-1:1),ad("/api/posts/vote",{post_id:l.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:liked?0:1}),q(this).html(q(this).html().replace(/\(\d+\)/,"")+(likes?"("+likes+")":"")),l[liked?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-post-repost","click",function(i){var s=q(this).closest(".ds-post-self"),l=aQ[s.attr("data-post-id")];return ba.repostDialog(l,""),!1}).delegate("a.ds-post-delete","click",function(l){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var i=q(this).closest(".ds-post-self");ad("/api/posts/remove",{post_id:i.attr("data-post-id")}),i.parent().fadeOut(200,function(){a.data.comments--,a.updateCounter("duoshuo"),q(this).remove()})}return !1}).delegate("a.ds-post-report","click",function(i){if(confirm("\u786e\u5b9a\u8981\u4e3e\u62a5\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var l=q(this).closest(".ds-post-self");ad("/api/posts/report",{post_id:l.attr("data-post-id")}),alert("\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01")}return !1}).delegate("a.ds-post-reply","click",function(l){var y=q(this),i=y.closest(".ds-comment-actions");if(i.hasClass("ds-reply-active")){g.el.fadeOut(200,function(){q(this).detach()}),i.removeClass("ds-reply-active")}else{var B=y.closest(".ds-ctx-entry, .ds-post-self");g?g.actionsBar.removeClass("ds-reply-active"):(g=new ax.Replybox(a),g.render(!0).el.addClass("ds-inline-replybox").detach()),g.el.find("[name=parent_id]").val(B.attr("data-post-id")),g.el.show().appendTo(y.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),g.actionsBar=i.addClass("ds-reply-active"),h.max_depth<=1?g.postList=a.postList.el:(g.postList=B.siblings(".ds-children"),g.postList[0]||(g.postList=q('<ul class="ds-children"></ul>').insertAfter(B)))}return !1}).delegate("a.ds-weibo-comments","click",function(i){var l=q(this).closest(".ds-post-self"),B=l.attr("data-post-id"),F=l.data("source");if(l.attr("data-root-id")==0){var y=l.siblings(".ds-children");y[0]?y.remove():(y=q('<ul class="ds-children"></ul>').insertAfter(l),aH("/api/posts/listComments",f({post_id:B}),function(s){r(s),y.append(q.map(s.response,function(G){return aD.post(G,h)}).join(""))}))}return !1}).delegate("a.ds-weibo-reposts","click",function(I){var y=q(this).closest(".ds-post-self"),F=aQ[y.attr("data-post-id")],G=F.data.source;if(!aY.data.social_uid[G=="qqt"?"qq":G]){u(G);return}var B=F.data.root_id,J=B!="0"?aQ[B]:F,i="";if(B!="0"){var l=aF(F.data);i=(G=="weibo"?"//@"+l.name:"|| @"+l.qqt_account)+":"+F.data.message}return ba.repostDialog(J,i,a,G),!1}).delegate("a.ds-expand","click",function(i){var l=q(this).parent();return l.siblings().show(),l.remove(),!1}),bc.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",function(s){var i=this;if(bubbleOutTimer&&b.owner==i){clearTimeout(bubbleOutTimer),bubbleOutTimer=0}else{var l=q(i);E=setTimeout(function(){E=0,b.owner=i,z();var K=l.offset(),F=a.el.offset(),J=l.innerWidth()/2,I=a.el.innerHeight()-(K.top-F.top)+6,L=K.left-F.left-35+(J>35?35:J);try{if(l.hasClass("ds-comment-context")){n.attr("id","ds-ctx-bubble").attr("data-post-id",l.attr("data-post-id")).html('<ul id="ds-ctx">'+aD.ctxPost(aQ[l.attr("data-parent-id")].data)+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">\u67e5\u770b\u5bf9\u8bdd</a></div>')}else{if(l.hasClass("ds-avatar")||l.hasClass("ds-user-name")){var y={},B=y.user_id=l.attr("data-user-id");if(!B){throw"no info"}n.attr("id","ds-user-card").attr("data-user-id",B).empty(),a7[B]?n.html(aD.userInfo(a7[B].data)):aH("/api/users/profile",f(y),function(M){var N=M.response;a7[B]?a7[B].set(N):a7[B]=new ao(N),b.owner==i&&n.html(aD.userInfo(N))})}}b.css({bottom:I,left:L}).appendTo(a.innerEl)}catch(G){b.detach()}},200)}}).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",function(){E?(clearTimeout(E),E=0):bubbleOutTimer||bubbleOut()})}function u(a){var g=aD[aj()?"loginUrl":"bindUrl"](a);bc.authInWin&&v(a,g)||(aW.href=g)}function o(){var a=aC("<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2>"+aD.serviceList()+aD.additionalServices()).el.find(".ds-dialog").css("width","300px");t(a)}function f(a){var g={require:"site,visitor,nonce,serverTime,lang"+(H++?"":",unread,log,extraCss"),site_ims:aO&&aO["ds_site_"+bg.short_name+":timestamp"],lang_ims:aO&&aO["ds_lang_"+bg.short_name+":timestamp"],referer:a2.referrer};bg.stylePatch&&(g.style_patch=bg.stylePatch);for(var h in g){g[h]&&(!a0||encodeURIComponent(g[h]).length<200)&&(a[h]=g[h])}return a}var q=ba.jQuery,x=q(am),d=q(a2),r=ba.loadRequire=function(a){a.serverTime&&(ah=(new Date).getTime()-a.serverTime*1000),a.visitor&&(!aY.data&&a.visitor.user_id&&a5&&!a5.checkPermission()&&al({logged_user_id:a.visitor.user_id}),aY.reset(a.visitor)),a.site&&(aN.reset(a.site),ay("ds_site_"+bg.short_name,a.site,a.serverTime)),!ba.theme&&aN.data.theme&&aT(aN.data.theme),a.lang&&(ar(aE,a.lang),ay("ds_lang_"+bg.short_name,a.lang,a.serverTime));if(a.stylesheets){for(var g=0;g<a.stylesheets.length;g++){ba.injectStylesheet(a.stylesheets[g])}}a.nonce&&(ba.nonce=a.nonce),a.style&&ba.setCustomStyle((a.style||"")+ba.compileStyle(bg.component_style)),a.unread&&aB.reset(a.unread)},p=function(a){a.stopPropagation()},m=function(a){(a.ctrlKey&&a.which==13||a.which==10)&&q(this.form).trigger("submit")},D=function(a){var g=q(this);g.height(Math.max(54,g.next(".ds-hidden-text").text(this.value).height()+27))},v=function(h,g){var a={weibo:[760,600],renren:[420,322],qq:[504,445],netease:[810,645],sohu:[972,600],google:[600,440],taobao:[480,585]}[h]||[550,400];return am.open(g+(g.indexOf("?")==-1?"?":"&")+ba.param({origin:aW.origin||"http://"+aW.host}),"_blank","width="+a[0]+",height="+a[1]+",toolbar=no,menubar=no,location=yes")},t=function(a,g){bc.authInWin&&a.find(g||"a.ds-service-link").click(function(h){var i=this.href.match(/\/(login|bind)\/(\w+)\//i);if(!i||!ba.serviceNames[i[2]]){return}return !v(i[2],this.href)})},c=function(a){return bc.touch&&a.addClass("ds-touch"),a3("transition")||a.addClass("ds-no-transition"),a0&&a.addClass("ds-ie6"),q.support.opacity||a.addClass("ds-no-opacity"),a},e=function(a){if(!bc.placeholder){var g=a.attr("placeholder");a.val(g).focus(function(){this.value===g&&(this.value="")}).blur(function(){this.value===""&&(this.value=g)})}return a};if(am.postMessage){var k=function(a){if(a.origin==="http://duoshuo.com"){switch(a.data.type){case"login":aW.href=a.data.redirectUrl;break;default:}}};am.addEventListener?am.addEventListener("message",k,!1):am.attachEvent&&am.attachEvent("onmessage",k)}ba.scrollTo=function(a){var g=a.offset().top;(g<x.scrollTop()||g>x.scrollTop()+x.height())&&q("html, body").animate({scrollTop:g-40},200,"swing")},ba.toJSON=function(a){var y=/\r?\n/g,g=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,i=/^(?:select|textarea)/i,l=a.map(function(){return this.elements?q.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||i.test(this.nodeName)||g.test(this.type))}).map(function(s,B){var F=q(this).val();return F==null?null:q.isArray(F)?q.map(F,function(G,I){return{name:B.name,value:G.replace(y,"\r\n")}}):{name:B.name,value:F.replace(y,"\r\n")}}).toArray(),h={};return q.each(l,function(){h[this.name]=this.value}),h};var w=ba.Widget=bh.extend({init:function(a,g){this.el=a,this.options=g||{},this.render()},render:function(){},reset:function(){},load:function(a){switch(a.code){case 0:r(a),this.onload(a);break;default:this.onError(a)}},onload:function(a){this.el.html(aD[this.tmpl].call(aD,a.response,q.extend(this.options,a.options)))},onMessage:function(){},onError:function(a){aA("\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage),a.errorTrace&&aA(a.errorTrace)}}),A=function(a){var i={"unread-comments":{title:"\u65b0\u7559\u8a00\u53ca\u56de\u590d",apiUrl:"/api/users/unreadComments",tmpl:function(l){return'<li data-thread-id="'+l.thread.thread_id+'">'+q.map(l.authors,aD.userAnchor).join("\u3001")+' \u5728 <a class="ds-read" href="'+l.thread.url+'#comments" target="_blank">'+aR(l.thread.title||"\u65e0\u6807\u9898")+'</a> \u4e2d\u56de\u590d\u4e86\u4f60 <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)">\u77e5\u9053\u4e86</a></li>'},read:function(l){var s=l.attr("data-thread-id");ad("/api/threads/read",{thread_id:s}),aB.data.comments--}},"unread-notifications":{title:"\u7cfb\u7edf\u6d88\u606f",apiUrl:"/api/users/unreadNotifications",tmpl:function(l){return'<li data-notification-id="'+l.notification_id+'" data-notification-type="'+l.type+'">'+l.content+' <a class="ds-delete ds-read" title="\u77e5\u9053\u4e86" href="javascript:void(0)">\u77e5\u9053\u4e86</a></li>'},read:function(l){var s=l.attr("data-notification-id");ad("/api/notifications/read",{notification_id:s}),aB.data.notifications--}}}[a],g=aC("<h2>"+i.title+'</h2><ul class="ds-unread-list"></ul>');g.on("close",ba.resetNotify);var h=g.el.find(".ds-unread-list").delegate(".ds-delete","click",function(l){return q(this).parent().remove(),h.children().length===0&&g.close(),!1}).delegate(".ds-read","click",function(l){i.read(q(this).parent())});q("#ds-notify").hide(),aH(i.apiUrl,{},function(l){g.el.find(".ds-unread-list").html(q.map(l.response,i.tmpl).join("\n"))}),a5&&a5.checkPermission()&&a5.requestPermission(aI)};ba.resetNotify=function(){var a=q("#ds-notify"),g=aB.data;a[0]||(a=q('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[aN.data.notify_position]).delegate(".ds-notify-unread a","click",function(h){return A(q(this).data("type")),!1}).appendTo(a2.body)),a.html('<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="\u591a\u8bf4"></a><ul class="ds-notify-unread"><li'+(g.comments?"":' style="display:none;"')+'><a data-type="unread-comments" href="javascript:void(0);">\u4f60\u6709'+g.comments+"\u6761\u65b0\u56de\u590d</a></li><li"+(g.notifications?"":' style="display:none;"')+'><a data-type="unread-notifications" href="javascript:void(0);">\u4f60\u6709'+g.notifications+"\u6761\u7cfb\u7edf\u6d88\u606f</a></li></ul></div>")[(g.comments||g.notifications)&&aN.data.notify_position!=="hidden"&&!q(".ds-dialog")[0]?"show":"hide"]()},aB.on("reset",ba.resetNotify),aD.replybox=function(h,I){var y=h.options,F=aY.data,l=[],G="",B,J={thread_id:h.threadId,parent_id:"",nonce:ba.nonce};for(var g in F.repostOptions){F.repostOptions[g]&&(l.push(g),B=1),G+=aD.serviceIcon(g,!F.repostOptions[g])}return'<div class="ds-replybox"><a class="ds-avatar"'+(aj()?' href="javascript:void(0);" onclick="return false"':' href="'+ba.REMOTE+"/settings/avatar/"+bb(bd())+'" target="_blank" title="\u8bbe\u7f6e\u5934\u50cf"')+">"+aD.avatarImg(F)+'</a><form method="post">'+aV(J)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+aR(aE.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre></div><div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">'+(!aj()&&G?'<input id="ds-sync-checkbox'+(I?"-inline":"")+'" type="checkbox" name="repost" '+(B?'checked="checked" ':"")+'value="'+l.join(",")+'"> <label for="ds-sync-checkbox'+(I?"-inline":"")+'">'+aE.share_to+"</label>"+G:"")+'</span></div><button class="ds-post-button" type="submit">'+aR(aE.post)+'</button><div class="ds-toolbar-buttons">'+(y.use_smilies?'<a class="ds-toolbar-button ds-add-emote" title="\u63d2\u5165\u8868\u60c5"></a>':"")+(y.use_images&&y.parse_html_enabled?'<a class="ds-toolbar-button ds-add-image" title="\u63d2\u5165\u56fe\u7247"></a>':"")+"</div></div></form></div>"},ax.Replybox=function(a){this.embedThread=a},ax.Replybox.prototype={render:function(G){function W(a){a.data("submitting",!0),a.find(".ds-post-button").addClass("ds-waiting").html(aE.posting)[0].disabled=!0}function Q(a){a.data("submitting",!1),a.find(".ds-post-button").removeClass("ds-waiting").html(aE.post)[0].disabled=!1}var P=this,R=P.embedThread,U=R.options,X=function(a){ba.require("smilies",function(){})},g=P.el=q(aD.replybox(R,G)).click(X),J=g.find("form"),M=J.find("input[type=checkbox]")[0],y=J.find("a.ds-service-icon, a.ds-service-icon-grey"),K=e(J.find("textarea")).focus(X).keyup(m).keyup(D).bind("focus mousedown mouseup keyup",aJ),F=g.find(".ds-add-emote").click(function(a){var h=ba.smiliesTooltip;return F.toggleClass("ds-expanded").hasClass("ds-expanded")?(h||(h=ba.smiliesTooltip=new ax.SmiliesTooltip,h.render(),ba.require("smilies",function(){h.reset("\u5fae\u535a-\u9ed8\u8ba4")})),h.replybox=P,h.el.appendTo(a2.body).css({top:P.el.offset().top+P.el.outerHeight()+4+"px",left:P.el.find(".ds-textarea-wrapper").offset().left+"px"}),q(a2.body).click(I)):I(a),!1}),i=g.find(".ds-add-image").click(function(a){var l=K[0],N=l.value,h="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740",S='<img src="'+h+'" />';if(a2.selection){l.value=N.substring(0,a8.start)+S+N.substring(a8.end,N.length),l.value=l.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),l.focus();var L=a2.selection.createRange();L.collapse(),L.findText(h),L.select()}else{l.value=N.substring(0,l.selectionStart)+S+N.substring(l.selectionEnd);var T=l.value.search(h);l.setSelectionRange(T,T+h.length),l.focus()}a.preventDefault()}),I=P.hideSmilies=function(a){F.removeClass("ds-expanded"),ba.smiliesTooltip.el.detach(),q(a2.body).unbind("click",I)},V=function(a,L){var h=aC('<h2>\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2><div class="ds-icons-32">'+q.map(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(N){return'<a class="ds-'+N+'" href="'+aD.loginUrl(N)+'">'+ba.sourceName[N]+"</a>"}).join("")+"</div>"+(U.deny_anonymous?"":'<h2>\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+aR(aY.data.name)+'" required /><label for="ds-dialog-name">\u540d\u5b57(\u5fc5\u586b)</label></div>'+(U.require_guest_email?'<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+aR(aY.data.email)+'" required /><label for="ds-dialog-email">\u90ae\u7bb1(\u5fc5\u586b)</label></div>':"")+(U.require_guest_url?'<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+aR(aY.data.url||"")+'" /><label for="ds-dialog-url">\u7f51\u5740(\u53ef\u9009)</label></div>':"")+'<button type="submit">\u53d1\u5e03</button></form>')),s=h.el.find(".ds-dialog").css("width","320px");t(s,".ds-icons-32 a");if(!U.deny_anonymous){var l=h.el.find("form");l.submit(function(N){var S=l.find("input[name=author_email]").val();return(S||U.require_guest_email)&&!S.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(alert("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684email\u5730\u5740."),!1):(L(ba.toJSON(l)),h.close(),!1)}),l.find("input[name=author_name]")[0].focus()}};U.deny_anonymous&&K.focus(function(a){if(aj()){V(J,B);var h=function(l){l.stopPropagation(),K.unbind("click",h)};K.click(h)}return !1});var B=function(a){W(J),ad("/api/posts/create",q.extend(ba.toJSON(J),a),function(h){var s=h.response,l=j(P.postList,s,U);U.order=="asc"==(U.formPosition=="top")&&ba.scrollTo(l),aQ[s.post_id]=new ao(s),R.data.comments++,R.updateCounter("duoshuo"),K.val("").trigger("keyup"),Q(J),g.hasClass("ds-inline-replybox")&&(g.detach(),P.actionsBar.removeClass("ds-reply-active"));if(aO){try{aO.removeItem("ds_draft_"+R.threadId)}catch(L){}}},function(h){Q(J),alert(h.errorMessage)})};J.submit(function(a){if(J.data("submitting")){return !1}var h=q.trim(J[0].message.value);return h==""||!bc.placeholder&&h==K.attr("placeholder")?(alert("\u60a8\u8fd8\u6ca1\u5199\u5185\u5bb9\u5462"),!1):(aj()?V(J,B):B(),!1)});var O=function(a){return q(a).hasClass("ds-service-icon-grey")?null:q(a).attr("data-service")};return y.click(function(){return q(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),M.value=q.map(y,O).join(","),M.checked=M.value!="",!1}),q(M).change(function(){var a=this.checked;y[a?"removeClass":"addClass"]("ds-service-icon-grey")[a?"addClass":"removeClass"]("ds-service-icon"),this.value=q.map(y,O).join(",")}),this}},ax.Dialog=bh.extend({init:function(a,g){(this.el=q("#ds-wrapper"))[0]||(this.el=c(q('<div id="ds-wrapper"></div>'))),this.options=q.extend({width:600},g),a!==aL&&q(a).attr("id","ds-reset").appendTo(this.el)},open:function(){var a=this;a.el.hide().appendTo(a2.body).fadeIn(200),a0&&a.el.css("top",x.scrollTop()+100),a.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(i){return a.close(),!1}).click(p);var g=function(i){if(i.which==27){return a.close(),!1}},h=function(i){return a.close(),!1};return d.keydown(g),q(a2.body).click(h),a.close=function(i){d.unbind("keydown",g),q(a2.body).unbind("click",h),a.el.fadeOut(200,function(){q(this).remove()}),a.trigger("close")},a}}),aD.likePanel=function(a){return a.likes?'<span class="ds-highlight">'+a.likes+"</span> \u4eba\u559c\u6b22":""},aD.likeTooltip=function(a){var s={qzone:"QQ\u7a7a\u95f4",weibo:"\u65b0\u6d6a\u5fae\u535a",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",kaixin:"\u5f00\u5fc3\u7f51",douban:"\u8c46\u74e3\u7f51",baidu:"\u767e\u5ea6\u641c\u85cf",netease:"\u7f51\u6613\u5fae\u535a",sohu:"\u641c\u72d0\u5fae\u535a"},h=[];for(var l in s){h.push('<li><a class="ds-share-to-'+l+" ds-service-link ds-"+l+'" href="'+ba.hostUrl+"/share-proxy/?"+ba.param({service:l,thread_id:a.thread_id})+'">'+s[l]+"</a></li>")}var g=Math.ceil(h.length/2);return'<div class="ds-like-tooltip ds-rounded"><p>\u5f88\u9ad8\u5174\u4f60\u80fd\u559c\u6b22\uff0c\u5206\u4eab\u4e00\u4e0b\u5427\uff1a</p><ul>'+h.slice(0,g).join("")+"</ul><ul>"+h.slice(g).join("")+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">\u7b97\u4e86</a></p></div>'},ax.Meta=function(a){this.embedThread=a},ax.Meta.prototype={render:function(){var i=this,l=i.embedThread,h=l.data,y=i.el=q('<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded'+(h.user_vote>0?" ds-thread-liked":"")+'"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">'+(h.user_vote>0?"\u5df2\u559c\u6b22":"\u559c\u6b22")+'</span><span class="ds-thread-cancel-like">\u53d6\u6d88\u559c\u6b22</span></a><span class="ds-like-panel"></span></div>'),g=y.find(".ds-like-thread-button").click(function(s){var B=g.hasClass("ds-thread-liked");ad("/api/threads/vote",{thread_id:l.threadId,vote:B?0:1},function(F){q.each(F.response.thread,function(G,I){h[G]=I}),i.resetLikePanel()}),g.toggleClass("ds-thread-liked"),g.find(".ds-thread-like-text").text(B?"\u559c\u6b22":"\u5df2\u559c\u6b22");var a=function(F){i.tooltip.detach(),q(a2.body).unbind("click",a)};return B?i.tooltip&&a(s):(i.tooltip===aL&&(i.tooltip=q(aD.likeTooltip(h)).click(p).delegate("a","click",function(F){switch(this.className){case"ds-like-tooltip-close":a(F);break;default:if(!am.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no")){return}}return !1})),i.tooltip.appendTo(l.innerEl).css({top:y.position().top+y.outerHeight()-4+"px",left:0}),q(a2.body).click(a)),!1});return i.resetLikePanel(),aj()&&y.hide(),i},resetLikePanel:function(){this.el.find(".ds-like-panel").html(aD.likePanel(this.embedThread.data))}},aD.postListHead=function(a){var h=a.data,g=a.options;return'<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+aE.latest+'</a><a class="ds-order-asc">'+aE.earliest+'</a><a class="ds-order-hot">'+aE.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>'+(g.show_reposts&&h.reposts?'<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>':"")+(g.show_weibo&&h.weibo_reposts?'<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>':"")+(g.show_qqt&&h.qqt_reposts?'<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>':"")+"</ul></div>"},ax.PostListHead=function(a){this.embedThread=a},ax.PostListHead.prototype={render:function(){var a=this.embedThread,y=a.options,g=a.postList,i=this.el=q(aD.postListHead(a)),l=i.find("ul.ds-comments-tabs").delegate(".ds-tab a","click",function(B){l.find("a.ds-current").removeClass("ds-current"),g.params.page=1;var s=B.currentTarget;switch(s.className){case"ds-comments-tab-duoshuo":g.params.source="duoshuo",a.replybox.el.show();break;case"ds-comments-tab-repost":g.params.source="repost",a.replybox.el.hide();break;case"ds-comments-tab-weibo":g.params.source="weibo",a.replybox.el.hide();break;case"ds-comments-tab-qqt":g.params.source="qqt",a.replybox.el.hide();break;default:}return q(s).addClass("ds-current"),g.refetch(),!1}),h=i.find(".ds-sort").delegate("a","click",function(s){return h.find("a.ds-current").removeClass("ds-current"),g.params.order=y.order=this.className.replace("ds-order-",""),g.params.page=1,g.refetch(),q(this).addClass("ds-current"),!1});return h.find(".ds-order-"+g.params.order).addClass("ds-current"),this}},ax.Paginator=function(a){a=a||{};var i=this,g=i.el=a.el||q('<div class="ds-paginator"></div>'),h=i.collection=a.collection;g.delegate("a","click",function(l){return h.params.page=parseInt(this.innerHTML),h.refetch(),g.find(".ds-current").removeClass("ds-current"),q(this).addClass("ds-current"),!1})},ax.Paginator.prototype={reset:function(a){function g(i){l.push('<a data-page="'+i+'" href="javascript:void(0);">'+i+"</a>")}var s=this.collection.params.page||1,h,l=[];if(s>1){g(1),h=s>4?s-2:2,h>2&&l.push('<span class="page-break">...</span>');for(;h<s;h++){g(h)}}l.push('<a data-page="'+s+'" href="javascript:void(0);" class="ds-current">'+s+"</a>");if(s<a.pages){for(h=s+1;h<=s+4&&h<a.pages;h++){g(h)}h<a.pages&&l.push('<span class="page-break">...</span>'),g(a.pages)}this.el.html('<div class="ds-border"></div>'+l.join(" "))[a.pages>1?"show":"hide"]()}},aD.smiliesTooltip=function(a){var h='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var g in a){h+="<li><a>"+g+"</a></li>"}return h+'</ul><div class="ds-smilies-container"></div></div>'},ba.addSmilies=function(a,h){var g=ba.smiliesTooltip;g&&g.el.find("ul.ds-smilies-tabs").append("<li><a>"+a+"</a></li>"),ba.smilies[a]=h},ax.SmiliesTooltip=function(){},ax.SmiliesTooltip.prototype={render:function(){var a=this,g=a.el=q(aD.smiliesTooltip(aU));return g.click(p).find("ul.ds-smilies-tabs").delegate("a","click",function(h){a.reset(this.innerHTML)}),g.find(".ds-smilies-container").delegate("img","click",function(l){var B=a.replybox,h=B.el.find("textarea")[0],F=h.value;if(a2.selection){h.value=F.substring(0,a8.start)+this.title+F.substring(a8.end,F.length),h.value=h.value.replace(aE.leave_a_message,""),h.focus();var y=a2.selection.createRange();y.moveStart("character",a8.start+this.title.length),y.collapse(),y.select()}else{var G=h.selectionStart+this.title.length;h.value=F.substring(0,h.selectionStart)+this.title+F.substring(h.selectionEnd),h.setSelectionRange(G,G)}B.hideSmilies(),h.focus()}),this},reset:function(a){var h=this.el.find("ul.ds-smilies-tabs");h.find("a.ds-current").removeClass("ds-current"),h.find("a").filter(function(){return this.innerHTML==a}).addClass("ds-current");var g="<ul>";return q.each(aU[a],function(y,s){var l=a.indexOf("\u5fae\u535a")===0?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+s.replace("_org","_thumb"):af+"/images/smilies/"+s;a==="WordPress"&&(y=" "+y+" "),g+='<li><img src="'+l+'" title="'+aR(y)+'" /></li>'}),g+="</ul>",this.el.find(".ds-smilies-container").html(g),this}},aD.postPlaceholder=function(){return'<li class="ds-post ds-post-placeholder">'+aE.no_comments_yet+"</li>"},aD.post=function(a,y){var g=aF(a),i=g.user_id?' data-user-id="'+g.user_id+'"':"",l=g.qqt_account||"",h=aD.timeHtml(a.created_at,a.url),B=a.parents||[];switch(a.source){case"duoshuo":h+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+aE.reply+"</a>"+aD.likePost(a)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+aE.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+aE.report+"</a>"+(a.privileges["delete"]?'<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+aE["delete"]+"</a>":"");break;case"qqt":case"weibo":h+='<a class="ds-weibo-comments" href="javascript:void(0);">'+aE.comments+(a.type.match(/\-comment$/)?"":'(<span class="ds-count">'+a.comments+"</span>)")+'</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+aE.reposts+(a.type.match(/\-comment$/)?"":'(<span class="ds-count">'+a.reposts+"</span>)")+"</a>";break;default:}return'<li class="ds-post" data-post-id="'+a.post_id+'"><div class="ds-post-self" data-post-id="'+a.post_id+'" data-thread-id="'+a.thread_id+'" data-root-id="'+a.root_id+'" data-source="'+a.source+'"><div class="ds-avatar"'+i+">"+aD.avatar(g)+(ba.sourceName[a.source]?aD.serviceIcon(a.source):"")+'</div><div class="ds-comment-body"><div class="ds-comment-header">'+(g.url?'<a class="ds-user-name ds-highlight" data-qqt-account="'+l+'" href="'+aR(g.url)+'" '+(g.user_id?" onclick=\"this.href='"+ba.hostUrl+"/user-url/?user_id="+g.user_id+"';\"":"")+' rel="nofollow" target="_blank"'+i+">"+aR(g.name)+"</a>":'<span class="ds-user-name"'+i+' data-qqt-account="'+l+'">'+aR(g.name)+"</span>")+'<span class="ua">'+ua(a.agent)+'</span><span class="ua">'+os(a.agent)+"</span></div>"+(y.max_depth==1&&y.show_context&&B.length?'<ol id="ds-ctx">'+q.map(B,function(s,F){return(F==1&&B.length>2?'<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">\u8fd8\u6709'+(B.length-2)+"\u6761\u8bc4\u8bba</a></li>":"")+(aQ[s]?aD.ctxPost(aQ[s].data,F,F&&F<B.length-1):"")}).join("")+"</ol>":"")+"<p>"+(B.length>=y.max_depth&&(!y.show_context||y.max_depth>1)&&a.parent_id&&aQ[a.parent_id]?'<a class="ds-comment-context" data-post-id="'+a.post_id+'" data-parent-id="'+a.parent_id+'">'+aE.reply_to+aR(aF(aQ[a.parent_id].data).name)+": </a>":"")+a.message+'</p><div class="ds-comment-footer ds-comment-actions'+(a.vote>0?" ds-post-liked":"")+'">'+h+"</div></div></div>"+(y.max_depth>1&&(a.childrenArray||a.children)&&a.source!="weibo"&&a.source!="qqt"?'<ul class="ds-children">'+q.map(a.childrenArray||a.children,function(s){return aQ[s]?aD.post(aQ[s].data,y):""}).join("")+"</ul>":"")+"</li>"};var b=q('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),n=b.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(a){aH("/api/posts/conversation",{post_id:n.attr("data-post-id")},function(h){g.el.find("ol").html(q.map(h.response,aD.ctxPost).join("\n"))});var g=aC('<h2>\u67e5\u770b\u5bf9\u8bdd</h2><ol id="ds-ctx"></ol>');return g.el.find(".ds-dialog").css("width","600px"),g.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),E=bubbleOutTimer=0,z=function(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)};bubbleOut=function(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,b.detach()},400)},b.mouseenter(z).mouseleave(bubbleOut),aD.userInfo=function(a){var g=[];return q.each(a.social_uid,function(h,i){g.push('<a href="'+ba.REMOTE+"/user-proxy/"+h+"/"+i+'/" target="_blank" class="ds-service-icon ds-'+h+'" title="'+ba.sourceName[h]+'"></a>')}),'<a href="'+aR(a.url)+'" class="ds-avatar" target="_blank">'+aD.avatarImg(a)+'</a><a href="'+aR(a.url)+'" class="ds-user-name ds-highlight" target="_blank">'+aR(a.name)+"</a>"+g.join("")+'<p class="ds-user-card-meta"><a href="'+ba.REMOTE+"/profile/"+a.user_id+'/" target="_blank"><span class="ds-highlight">'+a.comments+"</span>\u6761\u8bc4\u8bba</a></p>"+(a.description?'<p class="ds-user-description">'+aR(a.description)+"</p>":"")},aS.PostList=function(a){a&&(a.params&&(this.params=a.params),a.embedThread&&(this.embedThread=a.embedThread)),this.el=q('<ul class="ds-comments"></ul>')},aS.PostList.prototype={url:"/api/threads/listPosts",render:function(){return C.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(a){var g=this.embedThread.options;this.el.html(a[0]?q.map(a,function(h){return aQ[h]?aD.post(aQ[h].data,g):""}).join(""):aD.postPlaceholder())},refetch:function(){var a=this,g=q(aD.indicator()).appendTo(a2.body).fadeIn(200);a.el.fadeTo(200,0.5),aH(a.url,a.params,function(h){ae(aQ,h.parentPosts||h.relatedPosts),ae(a7,h.users),a.reset(h.response),a.embedThread.paginator.reset(h.cursor),a.el.fadeTo(200,1),ba.scrollTo(a.el),g.remove()})}},ba.repostDialog=function(a,B,h,l){var g=aC('<h2>\u8f6c\u53d1\u5230\u5fae\u535a</h2><div class="ds-quote"><strong>@'+aR(aF(a.data).name)+"</strong>: "+a.data.message+"</div><form>"+aV({post_id:a.data.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="'+aR(aE.repost_reason)+'">'+aR(B)+'</textarea><pre class="ds-hidden-text"></pre></div><div class="ds-actions">'+(l?aV({"service[]":l}):'<label><input type="checkbox" name="service[]" value="weibo"'+(aY.data.social_uid.weibo?' checked="checked"':"")+' /><span class="ds-service-icon ds-weibo"></span>\u65b0\u6d6a\u5fae\u535a</label>  <label><input type="checkbox" name="service[]" value="qqt"'+(aY.data.social_uid.qq?' checked="checked"':"")+' /><span class="ds-service-icon ds-qqt"></span>\u817e\u8baf\u5fae\u535a</label>')+'<button type="submit">'+aE.repost+"</button></div></form>"),y=g.el.find("form").submit(function(i){return !l&&!y.find("[type=checkbox]:checked")[0]?(alert("\u8fd8\u6ca1\u6709\u9009\u53d1\u5e03\u5230\u54ea\u513f\u5462"),!1):(ad("/api/posts/repost",ba.toJSON(y),function(F){if(h&&l){var J=h.options,G=j(h.postList.el,F.response[l],J);J.order=="asc"==(J.formPosition=="top")&&ba.scrollTo(G);var I=h.el.find(".ds-comments-tab-"+l+" span.ds-highlight");I.html(parseInt(I.html())+1)}}),g.close(),!1)});return y.find(".ds-actions [type=checkbox]").change(function(i){var s=this.value;if(this.checked&&!aY.data.social_uid[s=="qqt"?"qq":s]){u(s);return}}),e(y.find("textarea")).keyup(m).keyup(D).focus(),!1},aD.toolbar=function(a){var g=aD.logoutUrl();return'<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>\u5e10\u53f7\u7ba1\u7406</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">\u7ed1\u5b9a\u66f4\u591a</a></li><li><a target="_blank" href="'+ba.REMOTE+"/settings/"+bb(bd())+'">'+aR(aE.settings)+'</a></li><li><a rel="nofollow" href="'+g+'" style="border-bottom: none">\u767b\u51fa</a></li></ul></div><div class="ds-visitor">'+(aY.data.url?'<a class="ds-visitor-name" href="'+aR(aY.data.url)+'" target="_blank">'+aR(aY.data.name)+"</a>":'<span class="ds-visitor-name">'+aR(aY.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="\u65b0\u56de\u590d"></a></div></div>'},ax.EmbedThread=w.extend({uri:"/api/threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(ap.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var a=this.el.attr("id","ds-thread").append(aD.waitingImg()),h=a.width(),g=a.data("url")||!a.attr("data-thread-id")&&q("link[rel=canonical]").attr("href");g?a.data("url",ak(g)):a.data("container-url",aW.href),h&&h<=400&&a.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(a){var i={duoshuo:["comments","\u8bc4\u8bba"],repost:["reposts","\u8f6c\u8f7d"],weibo:["weibo_reposts","\u65b0\u6d6a\u5fae\u535a"],qqt:["qqt_reposts","\u817e\u8baf\u5fae\u535a"]};for(var g in i){if(!a||a==g){var h=this.data[i[g][0]];this.el.find(".ds-comments-tab-"+g).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+g+'"></span>'+h:(h?'<span class="ds-highlight">'+h+"</span>\u6761":"")+i[g][1])}}},onError:function(a){this.el.html("\u8bc4\u8bba\u6846\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage)},onload:function(K){var I=this,J=I.threadId=K.thread.thread_id,L=K.cursor,g=I.options=K.options,y=I.innerEl=c(q('<div id="ds-reset"></div>').appendTo(I.el));I.data=K.thread,ae(aQ,K.parentPosts||K.relatedPosts),ae(a7,K.users),I.el.find("#ds-waiting").remove(),g.like_thread_enabled&&(I.meta=new ax.Meta(I),I.meta.render().el.appendTo(y)),g.hot_posts&&K.hotPosts&&K.hotPosts.length&&(I.hotPosts=new ax.HotPosts(q('<div class="ds-rounded"></div>'),{max_depth:1,show_context:g.show_context}),I.hotPosts.thread=I,I.hotPosts.el.appendTo(y),I.hotPosts.onload({response:K.hotPosts,options:{}})),I.postListHead=new ax.PostListHead(I),I.postList=new aS.PostList({embedThread:I,params:{source:"duoshuo",thread_id:J,max_depth:g.max_depth,order:g.order,limit:g.limit}}),I.postList.render().reset(K.response),I.paginator=new ax.Paginator({collection:I.postList}),I.paginator.reset(L);var F=I.replybox=new ax.Replybox(I),i=F.render().el.find("textarea");F.postList=I.postList.el;if(aO){var B="ds_draft_"+J;i.bind("focus blur keyup",function(a){var h=q(a.currentTarget).val();try{aO[B]=h}catch(a){}}),aO[B]&&i.val(aO[B])}if(aj()){var G=q(aD.loginButtons()).delegate("a.ds-more-services","click",function(){return G.find(".ds-additional-services").toggle(),!1});t(G)}else{I.toolbar=q(aD.toolbar()).delegate(".ds-account-control","mouseenter",function(){q(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){q(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var a=aC("<h2>\u7ed1\u5b9a\u66f4\u591a\u5e10\u53f7</h2>"+aD.serviceList(1)+aD.additionalServices(1)+'<div style="clear:both"></div>').el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return t(a),!1}).delegate("a.ds-unread-comments-count","click",function(a){return A("unread-comments"),!1})}I.postListHead.render().el.appendTo(y)[g.formPosition=="top"?"before":"after"]('<a name="respond"></a>',I.toolbar||G,F.el).after(I.postList.el,I.paginator.el),I.updateCounter(),K.alerts&&q.each(K.alerts,function(a,h){q('<div class="ds-alert">'+h+"</div>").insertBefore(I.toolbar||G)}),g.message&&i.val(g.message).focus(),q(aD.poweredBy(g.poweredby_text)).appendTo(y),aB.on("reset",function(){var a=aB.data.comments||0;y.find("a.ds-unread-comments-count").html(a).attr("title",a?"\u4f60\u6709"+a+"\u6761\u65b0\u56de\u590d":"\u4f60\u6ca1\u6709\u65b0\u56de\u590d").css("display",a?"inline":"none")}),g.mzadx_id&&(ba.require("mzadxN",function(){}),q('<div id="MZADX_'+g.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(y),__mz_rpq=am.__mz_rpq||[],__mz_rpq.push({l:[g.mzadx_id],r:"1",_srv:"MZADX",_callback:function(a,h){}})),ba.thread=I,aB.data!==aL&&aB.trigger("reset"),aj()||al({visit_thread_id:I.threadId})},onMessage:function(a){j(this.postList.el,a,this.options)}}),aD.hotPosts=function(a,g){return'<div class="ds-header ds-gradient-bg">'+aE.hot_posts_title+"</div><ul>"+q.map(a,function(h){return aQ[h]?aD.post(aQ[h].data,g):""}).join("")+"</ul>"},ax.HotPosts=w.extend({params:"show-quote",tmpl:"hotPosts",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(a){w.prototype.onload.call(this,a),C.call(this.el.find("ul"),this.thread,this.options)}}),aD.commentList=function(a,g){return q.map(a,function(h){var i=aF(h);return'<li class="ds-comment'+(g.show_avatars?" ds-show-avatars":"")+'" data-post-id="'+h.post_id+'">'+(g.show_avatars?'<div class="ds-avatar">'+aD.avatar(i,g.avatar_size)+"</div>":"")+'<div class="ds-meta">'+aD.userAnchor(i)+(g.show_time?aD.timeHtml(h.created_at):"")+"</div>"+(g.show_title?'<div class="ds-thread-title">\u5728 <a href="'+aR(h.thread.url+"#comments")+'">'+aR(h.thread.title)+'</a> \u4e2d\u8bc4\u8bba</div><div class="ds-excerpt">'+h.message+"</div>":'<a class="ds-excerpt" title="'+aR(h.thread.title)+' \u4e2d\u7684\u8bc4\u8bba" href="'+aR(h.thread.url+"#comments")+'">'+h.message+"</a>")+"</li>"}).join("")},ax.RecentComments=w.extend({uri:"/api/sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",tmpl:"commentList",render:function(){this.el.attr("id","ds-recent-comments")}}),aD.recentVisitors=function(a,g){return q.map(a,function(h){return'<div class="ds-avatar">'+aD.avatar(h,g.avatar_size)+"</div>"}).join("")},ax.RecentVisitors=w.extend({uri:"/api/sites/listVisitors",params:"show-time avatar-size num-items channel-key",tmpl:"recentVisitors",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=q(aD.waitingImg()))}}),aD.topUsers=function(a,g){return q.map(a,function(h){return'<div class="ds-avatar">'+aD.avatar(h,g.avatar_size)+"<h4>"+h.name+"</h4></div>"}).join("")},ax.TopUsers=w.extend({uri:"/api/sites/listTopUsers",params:"show-time avatar-size num-items channel-key",tmpl:"topUsers",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-users").append(this.waitingEl=q(aD.waitingImg()))}}),aD.topThreads=function(a,g){return q.map(a,function(h){return'<li><a target="_blank" href="'+aR(h.url)+'" title="'+h.title+'">'+h.title+"</a></li>"}).join("")},ax.TopThreads=w.extend({uri:"/api/sites/listTopThreads",params:"range num-items channel-key",tmpl:"topThreads",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=q(aD.waitingImg()))}}),aD.loginWidget=function(){var a='<div class="ds-icons-32">';return q.each(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(h,g){a+='<a class="ds-'+g+'" href="'+aD.loginUrl(g)+'">'+ba.sourceName[g]+"</a>"}),a+"</div>"},ax.LoginWidget=w.extend({tmpl:"loginWidget",render:function(){var a=this.el;a.attr("id","ds-login").html(aD.loginWidget()),t(a,"a"),a.find("a.ds-logout").attr("href",aD.logoutUrl())}}),ax.ThreadCount=w.extend({onload:function(a){var i=this.el,g=i.data("count-type")||"comments",h=a.data[g];i[i.data("replace")?"replaceWith":"html"](aE[g+"_"+(h?h>1?"multiple":"one":"zero")].replace("{num}",h))}});var H=0;ba.initSelector=function(a,h){var g=[];a9()&&(q.isReady||!an)&&q(a).each(function(l,B){var F=q(B);if(F.data("initialized")){return}F.data("initialized",!0);var y=new ax[h.type](F,h);ai.push(y);if(h.type==="ThreadCount"){var G=F.attr("data-thread-key");F.attr("data-channel-key")&&(G=F.attr("data-channel-key")+":"+G),g.push(G),a1[G]||(a1[G]=new ao({})),a1[G].on("reset",function(){y.onload(this)})}else{if(y.uri){var i={};q.each(y.params.split(" "),function(s,I){i[I.replace(/-/g,"_")]=F.attr("data-"+I)||F.data(I)}),aH(y.uri,f(i),function(s){y.load(s)})}}}),g.length&&aH("/api/threads/counts",f({threads:g.join(",")}),function(i){r(i),ar(aE,i.options),ae(a1,i.response)})},(ba.initView=function(){q.each(aM,ba.initSelector)})(),q(function(){if(!a9()){return aA("\u7f3a\u5c11duoshuoQuery\u7684\u5b9a\u4e49")}setInterval(function(){q(".ds-time").each(function(){var a=q(this).attr("datetime");a&&(this.innerHTML=ba.elapsedTime(a))})},20000),bg.ondomready&&bg.ondomready(),ba.initView(),!H&&bg.short_name&&aH("/api/analytics/ping",f({}),r)})})})(window,document);